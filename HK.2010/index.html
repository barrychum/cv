<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge" /> 
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, minimal-ui" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		
		<script type="text/javascript">
			function hideUrlBar() {
				// hide URL field on the iPhone/iPod touch
				var p = String(navigator.platform);
	
				container = document.getElementById("container");
				if( p === 'iPad' || p === 'iPhone' || p === 'iPod touch' ){
					var v = (navigator.appVersion).match(/OS (\d+)_(\d+)_?(\d+)?/);
					if (parseInt(v[1], 10)>=7) {
						// iOS >=7
						if (container) {
							container.style.top=(0) + "px";
							container.style.left=(0) + "px";
							container.style.width=(window.innerWidth) + "px";
							container.style.height=(window.innerHeight) + "px";
							if (pano) {
								pano.setViewerSize(window.innerWidth, window.innerHeight);
							}						}
						window.scrollTo(0, 0);
					} else {
						if (container) {
							var cheight;
							switch(window.innerHeight) {
								case 208:cheight=268; break; // landscape
								case 260:cheight=320; break; // landscape, fullscreen
								case 336:cheight=396; break; // portrait, in call status bar
								case 356:cheight=416; break; // portrait 
								case 424:cheight=484; break; // portrait iPhone5, in call status bar
								case 444:cheight=504; break; // portrait iPhone5 
								default: cheight=window.innerHeight;
							}
							if ((cheight) && ((container.offsetHeight!=cheight) || (window.innerHeight!=cheight))) {
								container.style.height=cheight + "px";
							}
						}
						document.getElementsByTagName("body")[0].style.marginTop="1px";
						window.scrollTo(0, 1);
					}
				}
			}            
			if (window.addEventListener) {
				window.addEventListener("load", hideUrlBar);
				window.addEventListener("resize", hideUrlBar);
				window.addEventListener("orientationchange", hideUrlBar);
			}
	
		</script>
		<style type="text/css" title="Default">
			body, div, h1, h2, h3, span, p {
				font-family: Verdana,Arial,Helvetica,sans-serif;
				color: #000000; 
			}
			/* fullscreen */
			html {
				height:100%;
			}
			body {
				height:100%;
				margin: 0px;
				overflow:hidden; /* disable scrollbars */
			}
			body {
			  font-size: 10pt;
			  background : #ffffff; 
			}
			table,tr,td {
				font-size: 10pt;
				border-color : #777777;
				background : #dddddd; 
				color: #000000; 
				border-style : solid;
				border-width : 2px;
				padding: 5px;
				border-collapse:collapse;
			}
			h1 {
				font-size: 18pt;
			}
			h2 {
				font-size: 14pt;
			}
			.warning { 
				font-weight: bold;
			} 
			/* fix for scroll bars on webkit & Mac OS X Lion */ 
			::-webkit-scrollbar {
				background-color: rgba(0,0,0,0.5);
				width: 0.75em;
			}
			::-webkit-scrollbar-thumb {
    			background-color:  rgba(255,255,255,0.5);
			}
		</style>	
	</head>
	<body>
		<script type="text/javascript" src="pano2vr_player.js">
		</script>
		<div id="container" style="width:100%;height:100%;">
		This content requires HTML5/CSS3, WebGL, or Adobe Flash Player Version 9 or higher.
		</div>
		<script type="text/javascript">
	
	
			// create the panorama player with the container
			pano=new pano2vrPlayer("container");
			panorama='<?xml version="1.0" encoding="UTF-8"?>';
			panorama+='<panorama id="" hideabout="1">';
			panorama+='  <view fovmode="0" pannorth="35">';
			panorama+='    <start pan="-2.5" fov="41.5" tilt="-8.800000000000001"/>';
			panorama+='    <min pan="-73" fov="5" tilt="-29.5"/>';
			panorama+='    <max pan="73" fov="120" tilt="12"/>';
			panorama+='  </view>';
			panorama+='  <userdata title="" datetime="" description="" copyright="" tags="" author="" source="" comment="" info="" longitude="114.146329164505" latitude="22.27852355310795"/>';
			panorama+='  <hotspots width="180" height="20" wordwrap="1">';
			panorama+='    <label width="180" backgroundalpha="1" enabled="0" height="20" backgroundcolor="0xffffff" bordercolor="0x000000" border="1" textcolor="0x000000" background="1" borderalpha="1" borderradius="1" wordwrap="1" textalpha="1"/>';
			panorama+='    <polystyle mode="0" backgroundalpha="0.2509803921568627" backgroundcolor="0x0000ff" bordercolor="0x0000ff" borderalpha="1"/>';
			panorama+='  </hotspots>';
			panorama+='  <media/>';
			panorama+='  <input tile0url="images/Final_setting_146_o_0.jpg" prev5url="images/Final_setting_146_o_preview_5.jpg" prev4url="images/Final_setting_146_o_preview_4.jpg" prev3url="images/Final_setting_146_o_preview_3.jpg" prev2url="images/Final_setting_146_o_preview_2.jpg" prev1url="images/Final_setting_146_o_preview_1.jpg" prev0url="images/Final_setting_146_o_preview_0.jpg" tile5url="images/Final_setting_146_o_5.jpg" tilesize="5612" tile4url="images/Final_setting_146_o_4.jpg" tile3url="images/Final_setting_146_o_3.jpg" tilescale="1.001781895937277" tile2url="images/Final_setting_146_o_2.jpg" tile1url="images/Final_setting_146_o_1.jpg">';
			panorama+='    <preview color="0x808080"/>';
			panorama+='  </input>';
			panorama+='  <control simulatemass="1" lockedmouse="0" lockedkeyboard="0" dblclickfullscreen="0" invertwheel="0" lockedwheel="0" invertcontrol="1" speedwheel="1" sensitivity="8"/>';
			panorama+='</panorama>';
			panorama+='';
			pano.readConfigString(panorama);
			// hide the URL bar on the iPhone
			setTimeout(function() { hideUrlBar(); }, 10);
			window.addEventListener("load", function() { initMap(); });
		</script>
		<noscript>
			<p><b>Please enable Javascript!</b></p>
		</noscript>
<hr>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
<div id="mapdiv" style="width:700px; height:500px">map goes here!</div>
		
<script type="text/javascript">
	var lastFov = -1;
	var lastPan = -1;
	var lastZoom = -1;
	var radar=null;
	var activeNodeLatLng;
	var map;
	
	function updateRadar() 
	{
		if ((!activeNodeLatLng) || (!pano) || (!map)) return;
		var d2r = Math.PI/180 ;
		var r2d = 180/Math.PI ;
		
		var fov = pano.getFov();
		var pan = pano.getPanNorth();
		var zoom = map.getZoom();
		var gps=pano.getNodeLatLng("");
		if ((gps.length>=2) && ((gps[0]!=0) || (gps[1]!=0))) {
			if (zoom<6) zoom = 6; // avoid large radar beams on world map
		
			if ((fov==lastFov) && (pan==lastPan) && (zoom==lastZoom) && (gps[0]==activeNodeLatLng.lat()) && (gps[1]==activeNodeLatLng.lng())) return; // nothing to do
			lastPan=pan;
			lastFov=fov;
			lastZoom=zoom;
			activeNodeLatLng = new google.maps.LatLng(gps[0], gps[1]);
			var rLat = 4.0*r2d / Math.pow(2,zoom);     // beam size
			var rLng = rLat/Math.cos(activeNodeLatLng.lat() * d2r);
		
			// generate radar fan for fov
			var radar_poly = new Array();
		
			radar_poly.push(activeNodeLatLng);
			var segments=5;
			for (i=-segments; i<=segments; i++) {
				var angle = (fov / (2*segments)) * i;
				var x = -rLng * Math.sin((pan+angle)*d2r) + activeNodeLatLng.lng();
				var y =  rLat * Math.cos((pan+angle)*d2r) + activeNodeLatLng.lat();
				radar_poly.push(new google.maps.LatLng(y, x));
			}
			// clear old radar
			if (radar) {
				radar.setMap(null);
				radar = null;
			}
			// show radar
			radar = new google.maps.Polygon({
				paths: radar_poly,
				strokeColor: "#000000",
				strokeOpacity: 0.8,
				strokeWeight: 1,
				fillColor: "#000000",
				fillOpacity: 0.35
			});
		
			radar.setMap(map);
		} else {
			// clear radar 
			if (radar) {
				activeNodeLatLng = new google.maps.LatLng(0,0);
				radar.setMap(null);
				radar = null;
			}
		}
	}
  
  	function initMap() {
  	
		var gps=pano.getNodeLatLng("");
		if ((gps.length>=2) && ((gps[0]!=0) || (gps[1]!=0))) {
			activeNodeLatLng = new google.maps.LatLng(gps[0], gps[1]);
		} else {
			activeNodeLatLng = new google.maps.LatLng(0,0);
		}
	
		var mapOptions = {
			zoom: 14,
			center: activeNodeLatLng,
			mapTypeId: google.maps.MapTypeId.HYBRID
		};
		map = new google.maps.Map(document.getElementById('mapdiv'), mapOptions);
		var ids=pano.getNodeIds();
		var marker;
		var markerLocation;
		var bounds=new google.maps.LatLngBounds();
		for(var i=0;i<ids.length;i++) {
			var id=ids[i];
			var gps=pano.getNodeLatLng(id);
			if ((gps.length>=2) && ((gps[0]!=0) || (gps[1]!=0))) {
				markerLocation = new google.maps.LatLng(gps[0], gps[1]);
				marker = new google.maps.Marker({position: markerLocation,map: map});
				marker.setTitle(pano.getNodeTitle(id));
				marker.setAnimation(google.maps.Animation.DROP);
				marker.setClickable(true);
				marker.ggId=id;
				bounds.extend(markerLocation);
				google.maps.event.addListener(marker, 'click', function() {
					pano.openNext("{" + this.ggId + "}");
					activeNodeLatLng=this.position;
					lastFov=-1; // force radar update
				});
			}
		}
		if (!bounds.isEmpty()) {
			map.fitBounds(bounds);
		}
		setInterval(function() { updateRadar(); }, 50);
  	}
 </script>
	</body>
</html>
